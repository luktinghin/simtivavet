<!DOCTYPE html>
<html lang="en">
<head>


	<!--<link rel="stylesheet" href="Chart.css" />-->
	<link rel="stylesheet" href="styles.css">
	<link href="css/fontawesome.min.css" rel="stylesheet"> 
	<link href="css/regular.min.css" rel="stylesheet"> 
	<link href="css/solid.min.css" rel="stylesheet"> <!--font awesome-->
	<meta name="theme-color" content="#7B8092">
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
	<link rel="apple-touch-icon" href="apple-touch-icon.png" />
	<link rel="apple-touch-icon" sizes="57x57" href="apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png" />
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png" />


<meta name="apple-mobile-web-app-capable" content="yes">

 <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/12.9__iPad_Pro_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/10.5__iPad_Air_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/10.2__iPad_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/iPhone_11__iPhone_XR_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/12.9__iPad_Pro_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/11__iPad_Pro__10.5__iPad_Pro_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/10.5__iPad_Air_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/10.2__iPad_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/iPhone_11__iPhone_XR_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
<link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">


    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <link rel="manifest" href="manifest.json">
    <meta charset="utf-8">
	<meta name="description" content="Simple and free TIVA simulator">
    <meta name="keywords" content="simtiva, tiva, tci, free, simulator, terence, luk, cuhk, propofol, app, smartphones, apple, android">
    <meta name="author" content="Terence Luk">
    <title>SimTIVA Viewer</title>
</head>
<body class="" id="windowbody">
		<div id="modalHistory" class="modal">
			<div class="modal-content" id="modalHistorycontent">
				<div class="modal-header">PAST SCHEMES</div>
				<div class="modal-body" id="modalHistorytext">
				</div>
			</div>
		</div>

		<div id="modalWarning" class="modal alt">
			<div class="modal-content alt" id="modalWarningcontent">
				<div class="modal-header alt"><span class="title">Please wait</span><span class="close alt" onClick="hidewarningmodal()">&times;</span></div>
				<div class="modal-body alt">SimTIVA is loading up...</div>
			</div>
		</div>

<!--startmodal-->

		<div id="modalInitial" class="modal" style="display:none">
			<div class="modal-content" id="modalInitialcontent">
				<div class="modal-header">Enter patient data<!--<span class="close notcondensed" onClick="hideallmodal()">&times;</span>--><img onclick="displayAbout();" src="apple-touch-icon-180x180.png" style="position:absolute;right:6px;width:44px;cursor:pointer"></div>
				<div class="modal-body">
					<div class="paedimode_selector">
						<a class="button_paedimode active" id="paedimode0" onclick="switchpaedimode(0);">Adult</a><!--
						--><a class="button_paedimode" id="paedimode1" onclick="switchpaedimode(1);">Paediatric</a>
					</div>
					<table class="table-Init">
					<tr class="fr" id="row_age_adultmode">
						<td >Age (y) <i class="far fa-question-circle tooltip"><span class="tooltiptext" style="width: 80px; line-height:20px">0-100y</span></i></td>
						<td><input type="number" inputmode="decimal" id="inputAge" min="0.1" max="99" step="0.1" placeholder=" " onkeyup="sendToValidate(0)" required/></td>
					</tr>
					<tr class="fr" id="row_age_paedimode" style="display:none">
						<td>Age <i class="far fa-question-circle tooltip"><span class="tooltiptext">Actual chronological age</span></i></td>
						<td>
							<input type="number" inputmode="decimal" id="inputAgePaedi" placeholder=" " onkeyup="sendToValidate(0)"/>
							<select id="select_age_unit">
								<option value="d">Days</option>
								<option value="w">Weeks</option>
								<option value="m" selected>Months</option>
								<option value="y">Years</option>
							</select>
					</tr>
					<tr id="row_PMA_paedimode" style="display:none">
						<td><span style="letter-spacing: -0.5px">Post-menstrual age </span><i class="far fa-question-circle tooltip"><span class="tooltiptext" style="">Covariate for Eleveld; affects clearance in <6mo</span></i>
						</td>
						<td>
							<div id="PMA_td">
								<div id="PMA_entry"><input type="number" inputmode="decimal" id="inputPMA" placeholder=" "/>weeks</div>
								<div id="PMA_explanation" onclick="displayWarning('Post-menstrual age', 'Covariate for Eleveld model, affects clearance in <6 months old. Optional entry, omit for full term.')">What's this?</div>
							</div>
						</td>
					</tr>
					<tr>
						<td>Weight (kg) <i class="far fa-question-circle tooltip"><span class="tooltiptext">0-200kg, validation with BMI & weight-for-age</span></i></td>
						<td><input type="number" inputmode="decimal" id="inputBW" min="0.1" max="200" step="0.01" placeholder=" " onkeyup="sendToValidate(0)" required/></td>
					</tr>
					<tr id="row_height">
						<td>Height (cm) <i class="far fa-question-circle tooltip"><span class="tooltiptext">0-250cm, required for Schnider/Eleveld</span></i></td>
						<td><input type="number" inputmode="decimal" id="inputBH" min="0.1" max="250" step="0.1" placeholder=" " onkeyup="sendToValidate(0)" ></td>
					</tr>
					<tr id="row_gender"><td>Gender</td>
						<td>
							<select id="select_gender" onchange="sendToValidate(0)" >
								<option value="Male">Male</option>
								<option value="Female">Female</option>
							</select>
						</td>
					</tr>
					<tr><td>Model <i class="far fa-question-circle tooltip2"><span class="tooltiptext">Paedfusor: for children. Marsh/Schnider/Minto: for adults.</span></i></td>
						<td>
							<select id="select_model" onchange="sendToValidate(0)" >
								
									<option value="Marsh">Propofol (Marsh)</option>
									<option value="Schnider">Propofol (Schnider)</option>
									<option value="Paedfusor">Propofol (Paedfusor)</option>
									<option value="Eleveld">Propofol (Eleveld)</option>
								
								
									<option value="Minto">Remifentanil (Minto)</option>
									<option value="Eleveld-Remifentanil">Remifentanil (Eleveld)</option>
								
								
									<option value="Shafer">Fentanyl (Shafer)</option>

									<option value="Complex">Complex (Dual mode)</option>
								
							</select>

							<select id="select_model_paedi" onchange="sendToValidate(0)" style="display:none">
									<option value="Paedfusor">Propofol (Paedfusor)</option>
									<option value="Eleveld" selected>Propofol (Eleveld)</option>
									<option value="Eleveld-Remifentanil">Remifentanil (Eleveld)</option>
									<option value="Complex">Complex (Dual mode)</option>
							</select>
						</td>
					</tr>
					<tr id="row_remidilution"><td style="letter-spacing:-0.5px">Concentration <span style="font-size: 85%">(mcg/ml)</span></td>
						<td>
							<select id="select_remidilution" onchange="change_remidilution(this.value)"> 
								<option value="5">5mcg/ml</option>
								<option value="10">10mcg/ml</option>
								<option value="20" selected>20mcg/ml</option>
								<option value="25">25mcg/ml</option>
								<option value="50">50mcg/ml</option>
								<option value="custom">Custom</option>
							</select>
							<div id="custom_remidilution" onclick="popup_dilution('remidilution','remifentanil')">
								<span id="remidilution">_</span>mcg/ml
							</div>
						</td>
					</tr>
					<tr id="row_fen_weightadjusted"><td>Weight adjusted? <i class="far fa-question-circle tooltip3"><span class="tooltiptext">If YES: PK model adjusted to BW according to Shibutani, 2004; recommended for obese.</span></i></td>
						<td>
							<select id="select_fen_weightadjusted">
								<option value="0" >No</option>
								<option value="1" selected>Yes</option>
							</select>
						</td>
					</tr>
					<tr id="row_fendilution"><td style="letter-spacing:-0.5px">Concentration <span style="font-size: 85%">(mcg/ml)</span></td>
						<td>
							<select id="select_fendilution" onchange="change_fendilution(this.value)">
								<option value="5">5mcg/ml</option>
								<option value="10" selected>10mcg/ml</option>
								<option value="20">20mcg/ml</option>
								<option value="25">25mcg/ml</option>
								<option value="50">50mcg/ml</option>
								<option value="custom">Custom</option>
							</select>
							<div id="custom_fendilution" onclick="popup_dilution('fendilution','fentanyl')">
								<span id="fendilution">_</span>mcg/ml
							</div>
						</td>
					</tr>
					<tr id="row_dexmededilution"><td>Drug dilution (mcg/ml)</td>
						<td>
							<input type="number" inputmode="decimal" id="inputDexmedeDilution" value="4">
						</td>
					</tr>
					<!--
					<tr><td>File Name</td>
						<td>
							<input id="inputFileName1" value="" class="formTextInput" placeholder="Optional, Max 32 char.">
						</td>
					</tr>
				-->
					<!--<tr><td>Debug: Enter Sim Speed (1=default)</td><td><input type="number" id="simspeed" value="1"></td></tr>-->
					</table>
					<div id="valCard" class="translate">
						<div id="valLeft"></div>
						<div id="valRight">
							<div style="position:relative">
								<div id="valRightContainer1" class="">
									Waiting for input.
								</div>
								<div id="valRightContainer2" class="valClose">
									BMI: <span id="bmiDisplay"></span><span id="bmiForAgeDisplay"></span>
									<div id="wfaDiv">Weight for age: <span id="wfaDisplay"></span>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div id="validationDisplay">
					</div>
					
					<div id="checkmarkDisplay">
                    <label class="container" style="visibility:hidden;">I confirm the above data are correct.
                        <input type="checkbox" onChange="sendToValidate(1);checkChecked();" id="checkConfirm"><span class="checkmark"></span>
                    </label>
                    <label class="container" style="visibility:hidden;">I agree to the disclaimer.
                        <input type="checkbox" id="checkDisclaim" onChange="checkChecked();"><span class="checkmark"></span>
                    </label>
					</div>
					<div>
						<a class="button invert disabled" id="btn_initProceed">Proceed</a>
						<a class="button muted right" id="btn_disclaimer" onclick="displayDisclaimer();">Disclaimer</a>
						<a class="button muted right" id="btn_about" onclick="displayAbout();">About</a>
					</div>

			</div>
		</div>
	</div>


  <!-- start leftbar-->
  <div class="leftbar propofol hide">
  	<div class="ptolcontainer">
  		<div id="">&nbsp;
  		</div>
  	</div>
  	<div class="leftbarlabel">
  		<div class="druglabelcontainer propofol active" onclick="tabswitch(0);">
  			<div class="druglabelicon alert hide"><i class="fas fa-bell"></i></div>
  			<div class="druglabelicon propofol">
  				P
  			</div>
  			<div class="druglabeltext propofol active">
  				<div class="line1">PROPOFOL</div>
  				<div class="line2 hide">
  					<div class="line2text"><i class="fas fa-tint fa-fw"></i>&nbsp;<span id="cp_propo"></span>&nbsp;&nbsp;</div>
  					<div class="line2text"><i class="fas fa-brain fa-fw"></i>&nbsp;<span id="ce_propo"></span>&nbsp;&nbsp;</div>
  					<div class="line2text"><i class="fas fa-running fa-fw"></i>&nbsp;<span id="inf_propo"></span></div>
  				</div>
  			</div>
  		</div>
  	</div>
  	<div class="spacer">
  	</div>
  	<div class="leftbarlabel">
  		<div class="druglabelcontainer opioid " onclick="tabswitch(1);">
  			<div class="druglabelicon alert hide"><i class="fas fa-bell"></i></div>
  			<div class="druglabelicon opioid">
  				R
  			</div>
  			<div class="druglabeltext opioid ">
  				<div class="line1">REMIFENTANIL</div>
  				<div class="line2 hide">
  					<div class="line2text"><i class="fas fa-tint fa-fw"></i>&nbsp;<span id="cp_opioid"></span>&nbsp;&nbsp;</div>
  					<div class="line2text"><i class="fas fa-brain fa-fw"></i>&nbsp;<span id="ce_opioid"></span>&nbsp;&nbsp;</div>
  					<div class="line2text"><i class="fas fa-running fa-fw"></i>&nbsp;<span id="inf_opioid"></span></div>
  				</div>
  			</div>

  		</div>
  	</div>
  </div>
  <!-- end leftbar-->

	<div id="parallax3"></div>
    <div class="menuwrapper" id="menu">
        <div class="menucontent">
            <!--<a href="#" 
            onclick="showbaselayer(); window.scrollTo(0,0); togglemenu();" 
            ontouchstart="showbaselayer(); window.scrollTo(0,0); event.preventDefault(); togglemenu();">Home</a>-->
            <a href="#" 
            onclick="setmodal('modalAbout'); togglemenu();" 
            ontouchstart="setmodal('modalAbout'); event.preventDefault(); togglemenu();">About</a>
            <a href="#" 
            onclick="setmodal('modalReset'); togglemenu();" 
            ontouchstart="setmodal('modalReset'); event.preventDefault(); togglemenu();">Reset</a>
            <a href="#" 
            onclick="setmodal('modalHelp'); togglemenu();" 
            ontouchstart="setmodal('modalHelp'); event.preventDefault(); togglemenu();">Help</a>
            <a href="#" 
            onclick="setmodal('modalDocumentation'); togglemenu();" 
            ontouchstart="setmodal('modalDocumentation'); event.preventDefault(); togglemenu();">Documentation</a>
            <a href="#"
            onclick="sharefunction(); togglemenu();"
            ontouchstart="sharefunction(); event.preventDefault(); togglemenu();">Share</a><!--
            <a href="#" 
            onclick="setmodal('modalExport'); togglemenu();" 
            ontouchstart="document.getElementById('inputMaxDuration').value = Math.floor(time_in_s); setmodal('modalExport'); event.preventDefault(); togglemenu();">Export</a>-->
            <a href="https://simtiva.blogspot.com/p/feedback.html" 
            onclick="togglemenu();" 
            ontouchstart="">Contact</a>
            <!--<a href="#" onclick="setmodal('modaldisclaimer'); togglemenu();" ontouchstart="setmodal('modaldisclaimer'); event.preventDefault(); togglemenu();">Disclaimer</a>-->
        </div>
    </div>


	<div id="bodywrapper" class="">

		<div class="sharebutton" id="sharebutton" onclick="sharefunction();">
			<i class="fas fa-share-alt fa-fw"></i>
		</div>
		<div class="darkmodebutton" id="darkmodebutton" onclick="goDark();">
			<i class="fas fa-moon fa-fw"></i>
		</div>
		<div class="installbutton" id="installbutton">
			<i class="fas fa-download fa-fw" style="transform: translateY(2px);"></i>
			<div class="installtext" id="installtext">INSTALL</div>
			<div class="installclose" id="installclose"><i class="fas fa-times fa-fw"></i></div>
		</div>
		<div class="hamburger"  id="hamburger" style="display: none" onclick="togglemenu();">
          <div class="bar1"></div>
          <div class="bar2"></div>
          <div class="bar3"></div>
    	</div>
		<div id="parallax2">
			<div class="top-bar-container">
				<div class="topleft stop" id="iconplay" onclick="window.scrollTo(0,0);"><i class="fas fa-pause fa-lg"></i></div><!--
				--><div class="topright">
					<div class="top_subtitle " id="top_subtitle"><b>SimTIVA</b> - <span style="opacity: 50%; white-space:nowrap;" id="top_subtitle2">Simple TIVA simulator</span></div> 
					<div class="top_title " id="top_title">
						<div class="top_title_box cp" id="top_cp"><span id="cp">-</span></div>
						<div class="top_title_box ce" id="top_ce"><span id="ce">-</span></div>
						<div class="top_title_box infrate" id="top_infrate"><span id="infrate">-</span></div>
					</div>
				</div>
			</div>
		</div>
		<div id="parallax1">
			<!--<div id="parallaxtop" class="propofol">
				<div class="parallax_left">
					<div class="parallax_drug_name"><span class="parallax_drug_name1">Propofol</span><div id="parallax_desired">_</div>
					</div>
						<div class="parallax_drug_model">
							<span class="parallax_drug_model_name">Eleveld</span> | <span class="parallax_drug_conc">20mcg/ml</span>
						</div>
					</div>
					
				<div class="parallax_right">
					
						<div class="parallax_conc_box cp"><span id="cp_active">2.9</span>
						</div>
						<div class="parallax_conc_box ce"><span id="ce_active">3.3</span>
						</div>
						<div class="parallax_conc_box inf"><span id="inf_active">35</span>
						</div>
					
				</div>
			</div>
			-->
			<div id="parallax1container" class="">
				<div class="displayleft">
					<div class="clockcontainer"><span id="clock">_</span></div>
					<div class="VIcontainer">VI: <span id="displayvolume">_</span>ml</div>
				</div><!--
				--><div class="displayright">
					<div class="displaywrapper">
						<div class="">
							<span id="drugname"></span> (<span id="modelname"></span>)
							
						</div>
						<div><b>BW:<span id="bw"></span></b>, BH:<span id="bh"></span></div>
						<div><span id="age"></span>, <span id="gender"></span><!--<span id="temptimedisplay" style="float:right; opacity:50%"></span>--></div>
					</div>
				</div>
			</div>
		</div>
		<!--start parallax bottom-->
		<!--
		<div id="parallaxbottom">
			<div id="parallaxbottom_whitebox">&nbsp;</div>
			<div id="parallaxbottom_container"  class="remifentanil">
				<div class="parallax_left" >
					<div class="parallax_drug_name"><span class="parallax_drug_name1">Remifentanil</span>
						<div id="parallaxbottom_desired">_</div>
					</div>
						<div class="parallax_drug_model">
							<span class="parallax_drug_model_name">Minto</span> | <span class="parallax_drug_conc">20mcg/ml</span>
						</div>
					</div>
					
				<div class="parallax_right">
					
						<div class="parallax_conc_box cp"><span id="cp_alt">2.9</span>
						</div>
						<div class="parallax_conc_box ce"><span id="ce_alt">3.3</span>
						</div>
						<div class="parallax_conc_box inf"><span id="inf_alt">35</span>
						</div>
					
				</div>
			</div>
			<div id="parallaxbottom_message">
				<div id="parallaxbottom_message1"></div>
			</div>
		</div>
	-->
		<!-- end parallax bottom-->

		
		<div id="popupchartdiv" style="display: none;position:fixed;background:black;top:0;left:0;z-index:99;width:100%;height:100%;padding:0">
				<!--
				<div id="chartbuttons2" style="display:none">
					<a id="chartzoomin2" onclick="chartZoomToggle(1);"><i class="fas fa-search-plus"></i></a>
					<a id="chartoptions2" onclick="chartOptionsToggle();"><i class="fas fa-cog"></i></a>
					<a id="chartzoomout2" onclick="chartZoomToggle(0);"><i class="fas fa-search-minus"></i></a>
				</div>
				-->
				<div id="chartinfooverlay" class="">
					<div id="chartinfoleft" onclick="togglePopupInfo();"><i class="fas fa-chevron-circle-right fa-fw"></i></div><!--
					--><div id="chartinforight">
						<div id="chartinfotime"><span id="timecopy" class="timespan">0m 0s</span></div>
						<div id="chartinfodrugline1"><span id="drugnamecopy">DRUG</span><span id="modelnamecopy"></span><span id="conccopy">(_mg/ml)</span></div>
						<div id="chartinfodrugline2">Awaiting input</div>
						<div id="chartinfoscheme"><span id="nextratedescriptor">Rate info unavailable </span><span id="nextratecopy"></span><span id="nextratepreposition"></span><span id="timeremaincopy"></span></div>
						<div id="chartinfoptol">PTOL: __</div>
					</div>
				</div>
				<div id="chartoverlayoptions2" >
					<div id="chartoverlayoptions2content">
						<div id="closeoptions2" onclick="togglepopupoptions();">&times;</div>
						<div id="" style="font-weight:bold; margin-top:6px; margin-bottom:7px">Chart Options</div>
						<div id="chartoptionscheckbox2">
				      <label class="container labeloptionscontainer" style="">Automatic time scale
				          <input type="checkbox" id="isTimeAutomatic2" onChange="toggleautotime();" checked><span class="checkmark"></span>
				      </label>
						</div>
						<div style="padding-left:30px">Custom time range (min):</div>
						<div id="timerangeslider2">
							<div id="leftslidercontainer2">
								<input id="range0copy" value="10" min="0" max="30" step="5" type="range" oninput="processrange(0);">
								<div class="timerangetext" id="rangetext0copy">0</div>
							</div>
							<div id="rightslidercontainer2">
								<input id="range1copy" value="90" min="30" max="120" step="5" type="range" oninput="processrange(1);">
								<div class="timerangetext" id="rangetext1copy">30</div>
							</div>		
						</div>
						<div style="margin-top:30px" id="PD_options_group2">
				      <label class="container labeloptionscontainer" style="margin-bottom:0px">PD Effect estimation
				          <input type="checkbox" id="isEffectEstimationOn2" onChange="if (document.getElementById('isEffectEstimationOn').checked == true) {document.getElementById('isEffectEstimationOn').checked = false} else {document.getElementById('isEffectEstimationOn').checked = true;}toggleEffectEst();" checked><span class="checkmark"></span>
				      </label>
				      <select id="select_effect_measure2" style="margin-left:30px;width:calc(100% - 30px)" onChange="document.getElementById('select_effect_measure').value=document.getElementById('select_effect_measure2').value;toggleEffectEst();">
				      	<option value="bis">BIS 40-60</option>
				      	<option value="ptol">PTOL 50-90</option>
				      	<option value="nsri">NSRI 20-50</option>
				      </select>
						</div>
					</div>
					<div id="chartoverlayoptionscontentarrow2"></div>
				</div>
			<div id="popupchartcontainer" style="width:100%;height:100%;display:block;border-radius:1rem">
				<div style="display:inline-block;width:calc(100% - 108px);height:100%;"><canvas id="popupchart"></canvas></div><!--
				--><div style="display:inline-block;width:108px;vertical-align:top;padding:10px;height:100%">
						<div style="background:#198964; border-radius:0rem 1rem 1rem 1rem;height:100%"> 
							<!--right container-->
							<div class="pop_right_elem">
								<a class="pop_button" id="pop_button_close" onclick="destroypopup();">
									<i class="fas fa-times"></i>
								</a>
							</div>

							<div class="pop_right_elem">
								<div class="pop_title_box cp" id="pop_cp"><span id="cp_copy">-</span></div>
							</div>
							<div class="pop_right_elem">
								<div class="pop_title_box ce" id="pop_ce"><span id="ce_copy">-</span></div>
							</div>
							<div class="pop_right_elem">
								<div class="pop_title_box infrate" id="pop_infrate"><span id="infrate_copy">-</span></div>
							</div>
						
							<a class="pop_button" id="pop_button_options" onclick="togglepopupoptions();">
								<i class="fas fa-cog"></i>
							</a>

						</div>

				</div>
			</div>
		</div>

		<div id="controlpanel">
			<div id="prompts_container">
				<div class="prompts_card" id="warning" style="border-color:#e4c4c4">
					<div class="prompts_close" onclick="hide_prompts(this.parentElement); user_hide = 1; userhide();"><i class="fas fa-times-circle"></i></div>
					<div id="warningleft"><i class="fas fa-exclamation-circle" id="warningicon"></i></div>
					<div id="warningright">
						<div style="font-size:80%; font-weight:bold; color:red; border-bottom:1px solid #e4c4c4; padding-bottom:2px"><span id="warningdescriptor">REMINDER - next change in </span><div id="warningcounter">10s</div></div>
						<div style="" id="warningprompt">_</div>
					</div>
				</div>
				<div class="prompts_card" id="preview" style="border-color:#a9c5e4">
					<div class="prompts_close" onclick="hide_prompts(this.parentElement)"><i class="fas fa-times-circle"></i></div>
					<div id="previewleft"><i class="fas fa-arrow-circle-up" id="previewicon"></i></div>
					<div id="previewright">
						<div style="font-size:80%; font-weight:bold; border-bottom:1px solid #a9c5e4; padding-bottom:2px;line-height:1.2">PREVIEW: To achieve target <div id="preview_cpt"></div></div>
						<div style="line-height:1.2;padding-top:2px;font-size:95%" id="preview_msg"></div>
					</div>
				</div>
				<div class="prompts_card" id="prompt" style="border-color:#9bc99d">

					<div id="promptleft"><i class="fas fa-info-circle" id="prompticon"></i></div>
					<div id="promptright">
						<div style="font-size:80%; font-weight:bold; border-bottom:1px solid #9bc99d; padding-bottom:2px"><span id="prompt_msg2">Current rate</span></div>
						<div id="progressbar"></div>
						<div style="" id="prompt_msg"><span id="status">Waiting to start</span><span id="infusiondescriptor"></span></div>
					</div>
				</div>
			</div>

			<div class="cardscontainer">
				<!--<button onclick="openpopupchart()">POPUP</button>-->
			<!-- start cards container for layout-->
			<div class="card" id="card_infusion0"  style="display:none;">
				<div class="cardtitle">INFUSION</div>
			<div class="cardcontents">
				<table class="table-control line" id="tableInfusionRate0">
					<tr class="fr"><td>
							<div class="infusionratecontainer" id="infusionratecontainer0"><span id="infusionratedescription0">Infusion rate (ml/h)</span> 
								<span class="infusionrateselector" id="infusionrateselector0" onclick="dropdownshow(0)"><i class="fas fa-chevron-down"></i></span>
								<div class="infusionratedropdown" id="infusionratedropdown0">
									<a class="infusionratedropdownitem" id="infusionrateoption0" onclick="setInfusionUnit(0)"><i class="far fa-check-circle infusioncheck"></i>&nbsp; ml/h</a>
									<a class="infusionratedropdownitem" id="infusionrateoption1" onclick="setInfusionUnit(1)"><i class="far fa-circle infusioncheck"></i>&nbsp; mg/kg/h</a>
								</div>
							</div>
						</td><td><input type="number" inputmode="decimal" id="inputInfusion0" min="0" max="100" step="0.1" placeholder=" " onchange=""></td></tr>
				</table>
				<table class="table-control space" id="tableInitialBolus0">
					<tr><td>
							<div class="infusionratecontainer" id="boluscontainer0"><span id="bolusdescription0">Initial bolus (<span class="infused_units"></span>)</span>
								<span class="infusionrateselector" id="bolusselector0" onclick="dropdownshowbolus(0,'')"><i class="fas fa-chevron-down"></i></span>
							</div>
								<div class="infusionratedropdown" id="bolusdropdown0">
									<a class="infusionratedropdownitem" id="bolusoption0_0" onclick="setBolusUnit(0)"><i class="far fa-check-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span></a>
									<a class="infusionratedropdownitem" id="bolusoption1_0" onclick="setBolusUnit(1)"><i class="far fa-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span>/kg</a>
									<a class="infusionratedropdownitem" id="bolusoption2_0" onclick="setBolusUnit(2)"><i class="far fa-circle infusioncheck"></i>&nbsp; ml</a>
								</div>
							</div>
						</td><td><input type="number" inputmode="decimal" id="inputBolus_initial0" min="0" max="2000" step="0.01" placeholder=" " ></td></tr>
				</table>
				<a class="button" id="btn_start0" onclick="start_manual(0);">Start</a>
				<a class="button" id="btn_pause0" onclick="pause(0);">Pause</a>
			</div>
		</div>
			<div class="card" id="card_infusion1" style="display:none;">
				<div class="cardtitle">INFUSION.</div>
			<div class="cardcontents">
				<table class="table-control line" id="tableInfusionRate1">
					<tr class="fr"><td>
							<div class="infusionratecontainer" id="infusionratecontainer1"><span id="infusionratedescription1">Infusion rate (ml/h)</span> 
								<span class="infusionratecontainer" id="infusionrateselector1" onclick="dropdownshow(1)"><i class="fas fa-chevron-down"></i></span>
								<div class="infusionratedropdown" id="infusionratedropdown1">
									<a class="infusionratedropdownitem" id="infusionrateoptioncopy0" onclick="setInfusionUnit(0)"><i class="far fa-check-circle infusioncheck"></i>&nbsp; ml/h</a>
									<a class="infusionratedropdownitem" id="infusionrateoptioncopy1" onclick="setInfusionUnit(1)"><i class="far fa-circle infusioncheck"></i>&nbsp; mg/kg/h</a>
								</div>
							</div>
						</td><td><input type="number" inputmode="decimal" id="inputInfusion1" min="0" max="100" step="0.1" placeholder=" " onchange=""></td></tr>
				</table>
				<table class="table-control space" id="tableInitialBolus1">
					<tr><td>
							<div class="infusionratecontainer" id="boluscontainer1"><span id="bolusdescription1">Initial bolus (<span class="infused_units"></span>)</span>
								<span class="infusionrateselector" id="bolusselector1" onclick="dropdownshowbolus(1,'')"><i class="fas fa-chevron-down"></i></span>
							</div>
								<div class="infusionratedropdown" id="bolusdropdown1">
									<a class="infusionratedropdownitem" id="bolusoption0_1" onclick="setBolusUnit(0)"><i class="far fa-check-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span></a>
									<a class="infusionratedropdownitem" id="bolusoption1_1" onclick="setBolusUnit(1)"><i class="far fa-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span>/kg</a>
									<a class="infusionratedropdownitem" id="bolusoption2_1" onclick="setBolusUnit(2)"><i class="far fa-circle infusioncheck"></i>&nbsp; ml</a>
								</div>
							</div>
						</td><td><input type="number" inputmode="decimal" id="inputBolus_initial1" min="0" max="2000" step="0.01" placeholder=" " ></td></tr>
				</table>
				<a class="button" id="btn_start1" onclick="start_manual(1);">Start</a>
				<a class="button" id="btn_pause1" onclick="pause(1);">Pause</a>
			</div>
		</div>
		<div class="card hide" id="card_reanimate">
			<div class="cardtitle">RESUME SIMULATION</div>
			<div class="cardcontents">
				<div style="color:grey; font-size:90%">The recording of simulation data was suspended at: <br><span id="timestamp_lastdata"></span></div>
				<table class="table-control space">
					<tr class="fr">
						<td>Duration elapsed since simulation suspended:</td>
						<td>
							<select id="reanimate_select" onchange="sendtoreanimate(this.value*60);">
								<option value="0">0min</option>
								<option value="0.5">&lt;1min</option>
								<option value="1">1min</option>
								<option value="2">2mins</option>
								<option value="3">3mins</option>
								<option value="4">4mins</option>
								<option value="5">5mins</option>
								<option value="6">6mins</option>
								<option value="7">7mins</option>
								<option value="8">8mins</option>
								<option value="9">9mins</option>
								<option value="10">10mins</option>
								<option value="11">11mins</option>
								<option value="12">12mins</option>
								<option value="13">13mins</option>
								<option value="14">14mins</option>
								<option value="15">15mins</option>
								<option value="16">16mins</option>
								<option value="17">17mins</option>
								<option value="18">18mins</option>
								<option value="19">19mins</option>
								<option value="20">20mins</option>
								<option value="21">21mins</option>
								<option value="22">22mins</option>
								<option value="23">23mins</option>
								<option value="24">24mins</option>
								<option value="25">25mins</option>
								<option value="26">26mins</option>
								<option value="27">27mins</option>
								<option value="28">28mins</option>
								<option value="29">29mins</option>
								<option value="30">30mins</option>
								<option value="35">35mins</option>
								<option value="40">40mins</option>
								<option value="45">45mins</option>
								<option value="50">50mins</option>
								<option value="55">55mins</option>
								<option value="60">60mins</option>
							</select>
						</td>
					</tr>
					<tr>
						<td>Time point for resuming simulation:</td>
						<td><span id="timestamp_toberesumed"></span></td>
				</table>
				<a class="button" id="btn_reanimate" onclick="submit_reanimate();">Resume simulation</a>
			</div>
		</div>
		<div class="card" id="card_cpt0"  style="display:none;">
			<div class="cardtitle">Cp TARGETING</div>
			<div class="cardcontents">
				<table class="table-control space" id="tableCpt">
					<tr class="fr"><td>Enter Cp (<span class="conc_units"></span>/ml)</td><td><input type="number" inputmode="decimal" id="inputDesired0"  min="0.1" max="200" step="0.1" placeholder=" " oninput="displaypreview(this.value,0);"></td></tr>
				</table>
				<a class="button" id="btn_startCpt0" onclick="start_cpt();">Start</a>
				<a class="button" id="btn_pauseCpt0" onclick="pauseCpt(0); drug_sets[0].cpt_active=0.5;">Pause</a>
			</div>
		</div>
		<div class="card" id="card_cpt1" style="display:none;">
			<div class="cardtitle">Cp TARGETING.</div>
			<div class="cardcontents">
				<table class="table-control space" id="tableCpt">
					<tr class="fr"><td>Enter Cp (<span class="conc_units"></span>/ml)</td><td><input type="number" inputmode="decimal" id="inputDesired1"  min="0.1" max="200" step="0.1" placeholder=" " oninput="displaypreview(this.value,1);"></td></tr>
				</table>
				<a class="button" id="btn_startCpt1" onclick="
				start_cpt_complex(document.getElementById('inputDesired1').value*1,1);
				">Start</a>
				<a class="button" id="btn_pauseCpt1" onclick="pauseCpt(1); drug_sets[1].cpt_active=0.5;">Pause</a>
			</div>
		</div>
		<div class="card" id="card_cet0"  style="display:none;">
			<div class="cardtitle">Ce TARGETING</div>
			<div class="cardcontents">
				<table class="table-control space" id="tableCet">
					<tr class="fr"><td>Enter Ce (<span class="conc_units"></span>/ml)</td><td><input type="number" inputmode="decimal" style="border-radius:1rem; width:75px; border-width:2px" id="inputDesiredCe0" onfocus="this.nextElementSibling.style.display='inline-block';" min="0.1" max="200" step="0.1" placeholder=" " onkeyup="displaypreview(this.value,0);this.nextElementSibling.style.display='inline-block';" onblur="x=this;setTimeout(function(){x.nextElementSibling.style.display='none';},300)"><button id="clearCe" class="closeicon" onclick="clearInput('inputDesiredCe0');"></button></td></tr>
					<tr id="IB_swing_select_row0" class="IB_elements">
						<td>Peak/trough level</td>
						<td>
							<select id="IB_swing_select0" onchange="drug_sets[0].IB_swing=this.value*1">
								<option value="0.025">±2.5%</option>
								<option value="0.05" selected>±5%</option>
								<option value="0.075">±7.5%</option>
								<option value="0.1">±10%</option>
								<option value="0.125">±12.5%</option>
								<option value="0.15">±15%</option>
							</select>
						</td>
					</tr>
					<tr id="IB_interval_row0" class="IB_elements">
						<td>Bolus interval
						</td>
						<td id="IB_interval0">
						</td>
					</tr>
				</table>
				<!--
				<div id="IB_description" class="" style="color:grey; font-size:90%; padding-top:10px; padding-bottom:10px">
					The peak/trough levels represent the magnitude of fluctuation for Ce. For example, when set to ±5%, the Ce will reach a maximum of 105% of target and then drop to a minimum of 95% of target. At the trough level, another bolus will be administered, and the cycle repeats.
				</div>
			-->
				<a class="button" id="btn_startCet0" onclick="start_cet();">Start</a>
				<a class="button" id="btn_pauseCet0" onclick="pauseCpt(0); cet_active=0.5;">Pause</a>
				<span id="IB_about_btn0" onclick="displayIBabout();"><i class="fas fa-question-circle"></i></span>
				<!--
				<a class="button muted" id="btn_bolusconverter" onclick="start_cet_bolus();"><i class="fas fa-syringe"></i></a>
				-->
			</div>
		</div>
		<div class="card" id="card_cet1" style="display:none;">
			<div class="cardtitle">Ce TARGETING.</div>
			<div class="cardcontents">
				<table class="table-control space" id="tableCet1">
					<tr class="fr"><td>Enter Ce (<span class="conc_units"></span>/ml)</td><td><input type="number" inputmode="decimal" style="border-radius:1rem; width:75px; border-width:2px" id="inputDesiredCe1" onfocus="this.nextElementSibling.style.display='inline-block';" min="0.1" max="200" step="0.1" placeholder=" " onkeyup="displaypreview(this.value,1);this.nextElementSibling.style.display='inline-block';" onblur="x=this;setTimeout(function(){x.nextElementSibling.style.display='none';},300)"><button id="clearCe" class="closeicon" onclick="clearInput('inputDesiredCe1');"></button></td></tr>
					<tr id="IB_swing_select_row1" class="IB_elements">
						<td>Peak/trough level</td>
						<td>
							<select id="IB_swing_select1" onchange="drug_sets[1].IB_swing=this.value*1">
								<option value="0.025">±2.5%</option>
								<option value="0.05" selected>±5%</option>
								<option value="0.075">±7.5%</option>
								<option value="0.1">±10%</option>
								<option value="0.125">±12.5%</option>
								<option value="0.15">±15%</option>
							</select>
						</td>
					</tr>
					<tr id="IB_interval_row1" class="IB_elements">
						<td>Bolus interval
						</td>
						<td id="IB_interval1">
						</td>
					</tr>
				</table>
				<!--
				<div id="IB_description" class="" style="color:grey; font-size:90%; padding-top:10px; padding-bottom:10px">
					The peak/trough levels represent the magnitude of fluctuation for Ce. For example, when set to ±5%, the Ce will reach a maximum of 105% of target and then drop to a minimum of 95% of target. At the trough level, another bolus will be administered, and the cycle repeats.
				</div>
			-->
				<a class="button" id="btn_startCet1" onclick="start_cet_complex(document.getElementById('inputDesiredCe1').value*1,1);">Start</a>
				<a class="button" id="btn_pauseCet1" onclick="pauseCpt(1); cet_active=0.5;">Pause</a>
				<span id="IB_about_btn1" onclick="displayIBabout();"><i class="fas fa-question-circle"></i></span>
				<!--
				<a class="button muted" id="btn_bolusconverter" onclick="start_cet_bolus();"><i class="fas fa-syringe"></i></a>
				-->
			</div>
		</div>
		<div class="card" id="card_bolus0" style="display:none;">
			<div class="cardtitle">BOLUS</div>
			<div class="cardcontents">
				<table class="table-control space">
					<tr class="fr"><td>
							<div class="infusionratecontainer" id="boluscontainercopy0"><span id="bolusdescriptioncopy0">Custom bolus (<span class="infused_units"></span>)</span> <span class="infusionrateselector" id="bolusselectorcopy0" onclick="dropdownshowbolus(0,'copy')"><i class="fas fa-chevron-down"></i></span>
							</div>
								<div class="infusionratedropdown" id="bolusdropdowncopy0">
									<a class="infusionratedropdownitem" id="bolusoptioncopy0_0" onclick="setBolusUnit(0)"><i class="far fa-check-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span></a>
									<a class="infusionratedropdownitem" id="bolusoptioncopy1_0" onclick="setBolusUnit(1)"><i class="far fa-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span>/kg</a>
									<a class="infusionratedropdownitem" id="bolusoptioncopy2_0" onclick="setBolusUnit(2)"><i class="far fa-circle infusioncheck"></i>&nbsp; ml</a>
								</div>
						</td>
						<td width="30px"><input type="number" id="inputBolus0" min="0" max="2000" step="0.01" placeholder=" " ></td>
						<td><a class="button custom" id="" onclick="bolusadmin(custombolus(0),0);">Go!</button></a></td>
					</tr></table>
				
				<a class="button bolus" id="bolus3" onclick="bolusadmin(30,0);"><div class="bolus_outside">Bolus</div><div class="bolus_inside">30<span class="infused_units"></span></div></a>
				<a class="button bolus" id="bolus2" onclick="bolusadmin(20,0);"><div class="bolus_outside">Bolus</div><div class="bolus_inside">20<span class="infused_units"></span></div></a>
				<a class="button bolus" id="bolus1" onclick="bolusadmin(10,0);"><div class="bolus_outside">Bolus</div><div class="bolus_inside">10<span class="infused_units"></span></div></a>
			</div>
		</div>
		<div class="card" id="card_bolus1" style="display:none;">
			<div class="cardtitle">BOLUS.</div>
			<div class="cardcontents">
				<table class="table-control space">
					<tr class="fr">
						<td>
							<div class="infusionratecontainer" id="boluscontainercopy1"><span id="bolusdescriptioncopy1">Custom bolus (<span class="infused_units"></span>)</span>
								<span class="infusionrateselector" id="bolusselectorcopy1" onclick="dropdownshowbolus(0,'')"><i class="fas fa-chevron-down"></i></span>
							</div>
								<div class="infusionratedropdown" id="bolusdropdowncopy1">
									<a class="infusionratedropdownitem" id="bolusoptioncopy0_1" onclick="setBolusUnit(0)"><i class="far fa-check-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span></a>
									<a class="infusionratedropdownitem" id="bolusoptioncopy1_1" onclick="setBolusUnit(1)"><i class="far fa-circle infusioncheck"></i>&nbsp; <span class="infused_units"></span>/kg</a>
									<a class="infusionratedropdownitem" id="bolusoptioncopy2_1" onclick="setBolusUnit(2)"><i class="far fa-circle infusioncheck"></i>&nbsp; ml</a>
								</div>
							</div>
						</td>
						<td width="30px"><input type="number" id="inputBolus1"  min="0" max="2000" step="0.01" placeholder=" " ></td>
						<td><a class="button custom" id=""onclick="bolusadmin(custombolus(1),1);">Go!</button></a></td>
					</tr></table>
				
				<a class="button bolus" id="bolus3_1" onclick="bolusadmin(30,1);"><div class="bolus_outside">Bolus</div><div class="bolus_inside">30<span class="infused_units"></span></div></a>
				<a class="button bolus" id="bolus2_1" onclick="bolusadmin(20,1);"><div class="bolus_outside">Bolus</div><div class="bolus_inside">20<span class="infused_units"></span></div></a>
				<a class="button bolus" id="bolus1_1" onclick="bolusadmin(10,1);"><div class="bolus_outside">Bolus</div><div class="bolus_inside">10<span class="infused_units"></span></div></a>
			</div>
		</div>
		<div id="outputcontainer">
			<div id="outputselector">
				<a class="outputtab active" id="btn_displaychart" onclick="show_graph();">Graph</a>
				<a class="outputtab" id="btn_displayhistory" onclick="show_history();">History</a>
			</div>
			<div id="chartwrapper">
				<div id="chartoverlay">
					<div id="chartoverlaytext">Updating chart...</div>
				</div>
				<div id="chartbuttons">
					<a id="chartzoomin" onclick="chartZoomToggle(1);"><i class="fas fa-search-plus"></i></a>
					<a id="chartoptions" onclick="chartOptionsToggle();"><i class="fas fa-cog"></i></a>
					<a id="chartzoomout" onclick="chartZoomToggle(0);"><i class="fas fa-search-minus"></i></a>
				</div>
				<div id="chartoverlayoptions">
					<div id="chartoverlayoptionscontent">
						<div id="closeoptions" onclick="chartOptionsToggle();">&times;</div>
						<div id="" style="font-weight:bold; margin-top:6px; margin-bottom:9px">Chart Options</div>
						<div id="chartoptionscheckbox">
				      <label class="container labeloptionscontainer" style="">Display events
				          <input type="checkbox" onChange="toggleshowevents();" id="isShowEvents" checked><span class="checkmark"></span>
				      </label>
				      <label class="container labeloptionscontainer" style="">Automatic time scale
				          <input type="checkbox" id="isTimeAutomatic" onChange="toggleautotime();" checked><span class="checkmark"></span>
				      </label>
						</div>
						<div style="padding-left:30px">Custom time range (min):</div>
						<div id="timerangeslider">
							<div id="leftslidercontainer">
								<input id="range0" value="10" min="0" max="30" step="5" type="range" oninput="processrange(0);">
								<div class="timerangetext" id="rangetext0">0</div>
							</div>
							<div id="rightslidercontainer">
								<input id="range1" value="90" min="30" max="120" step="5" type="range" oninput="processrange(1);">
								<div class="timerangetext" id="rangetext1">30</div>
							</div>		
						</div>
						<div style="margin-top:30px" id="PD_options_group">
				      <label class="container labeloptionscontainer" style="">PD Effect estimation
				          <input type="checkbox" id="isEffectEstimationOn" onChange="toggleEffectEst();" checked><span class="checkmark"></span>
				      </label>
				      <select id="select_effect_measure" style="margin-left:30px;width:calc(100% - 30px)" onChange="toggleEffectEst();">
				      	<option value="bis">BIS 40-60</option>
				      	<option value="ptol">PTOL 50-90</option>
				      	<option value="nsri">NSRI 20-50</option>
				      </select>
						</div>
					</div>
					<div id="chartoverlayoptionscontentarrow"></div>
				</div>
				<div id="annotatebutton" style="display:none" onclick="setnow(Math.floor(time_in_s));document.getElementById('modalAnnotatetitle').innerHTML='ADD EVENT';document.getElementById('addeventtext').value='';document.getElementById('btn_submitevent').setAttribute('onclick','createEvent2(-1)');document.getElementById('btn_deleteevent').style.display='none';setmodal('modalAnnotate')">
					<i class="fas fa-pen"></i>
				</div>
				<div id="expandbutton" style="" onclick="openpopupchart();">
					<i class="fas fa-expand-alt"></i>
				</div>
				<div id="chartcontainer">
					<canvas id="myChart"></canvas>
				</div>
			</div>
			<div id="historywrapper2">
				<div id="historywrapper">
				</div>
			</div>
				<div id="pastscheme">
					<a id="pastschemebutton" onclick="displaymodalhistory();"><i class="fas fa-history"></i> Past Schemes</a>
				</div>
		</div>
		<div id="eventscontainer" style="display:block">

		</div>

		<div id="ptolcard" class="">
			<div id="ptolcard_left" style="padding:0.5rem;flex-basis:70%">
				<div style="font-size:200%;font-weight:bold;line-height:1" id=""><span id="ptoltitle">PTOL</span><span id="ptoltooltip" onclick="ptolwarning();" style="display:none"><i class="far fa-question-circle"></i></span></div>
				<div style="font-size:80%;opacity:50%" id="ptoldesc">Probability of tolerance to laryngoscopy (%)</div>
			</div><!--
			--><div id="ptolcard_right" style="flex-basis: 25%;text-align:center;font-size:400%;font-weight:bold">
				-
			</div><!--
			--><div id="ptolcard_switch" style="text-align:center;align-self:stretch;padding-top:30px; cursor:pointer" onclick="cycleEffectEst();">
				<div style="line-height:0.5">
					<i class="fas fa-caret-up"></i><br>
					<i class="fas fa-caret-down"></i>
				</div>
			</div>
		</div>


		<div id="interactionscontainer">
			<div id="interactionstabselector">
				<a class="interactionstab active" id="btn_displayisobologram" onclick="show_isobologram()">Isobologram</a>
				<a class="interactionstab" id="btn_displaylegend" onclick="show_legend();">PD Interaction</a>
			</div>
			<div id="chart2wrapper">
				
					
					<div id="chart2container">
						<canvas id="myChart2"></canvas>
					</div>
					

			</div> <!-- end chart2wrapper -->
			<div id="legendwrapper">
				<div class="legendtitle">Propofol-Opioid Interaction</div>
				<div class="legendcontent">Propofol and opioids such as remifentanil demonstrate intense synergism. The interaction can be quantified using a hypnotic-analgesic endpoint such as ablating response to laryngoscopy. For example, remifenanil concentration of 4ng/ml may reduce propofol concentration associated with loss of response to laryngoscopy by two-thirds (Bouillon 2001). Probability to tolerate laryngoscopy (PTOL) and its derivative, the noxious stimulation response index (NSRI), have been proposed as measures of potency of propofol-remifentanil drug combination (Hannivoort 2016).</div>
				<div class="legendtitle">Isobologram</div>
				<div class="legendcontent">Using different combinations of CE-propofol and CE-remifentanil (effect-site concentrations of propofol and remifentanil respectively), all yielding the same predicted response (90% probability to tolerate laryngoscopy, PTOL90), a line (isobole) is drawn connecting all the possible combinations of CE-propofol/CE-remifentanil to achieve the same identical effect (van den Berg 2021). In our simulation programme, the same method is repeated for PTOL80, PTOL70... PTOL10 to generate a total of 9 isoboles on the 2-dimensional chart. The contour of the isoboles is typical of synergism, or supradditive interaction.</div>
				<div class="legendtitle">Combinations of CEProp/CERemi for PTOL90</div>
				<div class="legendcontent">Using PTOL90 isobole as an example, the combinations of CE-propofol and CE-remifentanil yielding the identical effect are: {8.6mcg/ml, 1ng/ml}, {5.9mcg/ml, 2ng/ml}, {3.6mcg/ml, 4ng/ml}, {2mcg/ml, 8ng/ml} according to the Bouillon interaction model (van den Berg 2021). Following this, the clinician may decide on using PTOL as a guidance to control different CE of propofol/remifentanil based on haemodynamic, hypnotic, or other consequences while maintaining the same level of pharmacodynamic endpoint.</div>
			</div>

			<!-- obsolete code for UI interactions toggles
			<button onclick="complex_mode=1;">COMPLEX</button>
			<button onclick="readmodel('Minto',1);drug_sets[1].infusate_concentration=20;initcet_complex(1);complexinterface_init();">INIT MINTO CET</button>
			<button onclick="readmodel('Minto',1);drug_sets[1].infusate_concentration=20;initcpt_complex(1);complexinterface_init();">INIT MINTO CPT</button>
			<button onclick="readmodel('Minto',1);drug_sets[1].infusate_concentration=20;initmanual(1);complexinterface_init();">INIT MINTO MANUAL</button>
			<input id="remi_desired">
			<button onclick="start_cet_complex(getElementById('remi_desired').value*1,1);">DELIVER REMI</button>
			<button onclick="if (active_drug_set_index == 0) {myChart.data.datasets[6].data = ptol_generate_data_p(0.9);myChart.data.datasets[7].data = ptol_generate_data_p(0.5);} else {myChart.data.datasets[6].data = ptol_generate_data_r(0.9);myChart.data.datasets[7].data = ptol_generate_data_r(0.5)} myChart.update();">REFRESH CHART PTOL</button>
			<button onclick="setInterval(update_ptol,1000)">UPDATE PTOL 1s</button>
			<button onclick="testarg = 0; setInterval(function() {tabaltupdate();tabaltdisplaycycle(testarg);if (testarg==0) {testarg = 1} else {testarg = 0};},5000)">UPDATE TAB INFO 5s</button>
			<button onclick="tabswitch();">SWITCHTAB</button>
			-->

		</div> <!-- end interactions container -->

				
				<div style='display:none'>
					<div>CURRENT: <span id='isobole_chart_current'></span></div>
					<div>CURSOR: <span id='isobole_chart_description'></span></div>
					<div><b>PTOL:</b><span id="ptol"></span></div>
				</div>
		<div class="card" id="parameters">
			<div class="cardtitle">MODEL PARAMETERS</div>
			<div class="cardcontents"><span id="modeldescription"></span></div>
		</div>
		<div class="card" id="schemecopy">
			<div class="cardtitle" id="schemecopytitle">SCHEME</div>
			<div class="cardcontents" id="schemecopycontainer">
			

				<div id="historywrapperCOPY">Waiting to start.
				</div>
			
			</div>
				<div id="pastschemeCOPY">
					<a id="pastschemebuttonCOPY" onclick="displaymodalhistory();"><i class="fas fa-history"></i> Past Schemes</a>
				</div>
		</div>
		<div class="card" id="card_retrospective">
			<div class="cardtitle collapsiblecard">RETROSPECTIVE</div>
			<div class="cardcontents">
				<i style="color:grey; font-size:90%; padding-top:10px; padding-bottom:10px; display:block;">If you have given a bolus or changed the infusion rate some time ago but forgot to enter into SimTIVA, you can do retrospective correction here.</i>
				<table class="table-control">
					<tr class="fr"><td style="width:70%">How many mins ago? (Time X)</td>
						<td>
							<select id="retrospectiveTime">
								<option value="0.5">&lt;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>
								<option value="1">1</option>
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
							</select>
						</td>
					</tr>
					<tr><td>Dose of bolus given at X? (<span class="infused_units"></span>)</td>
						<td>
							<input type="number" inputmode="decimal" id="retrospectiveBolus"  min="0" max="400" step="0.1" placeholder=" " >
						</td>
					</tr>
					<tr><td>New infusion rate at X? (ml/h)</td>
						<td>
							<input type="number" inputmode="decimal" id="retrospectiveInfusion"  min="0" max="100" step="0.1" placeholder=" " >
						</td>
					</tr>
				</table>
				<a class="button" id="btn_retrospective" onclick="senddataretrospective();">Apply</a>
			</div>
		</div>
		<div class="card" id="card_TimeEstimation">
			<div class="cardtitle collapsiblecard">TIME ESTIMATION</div>
			<div class="cardcontents">
				<i style="color:grey; font-size:90%; padding-top:10px; padding-bottom:10px; display:block;">You can estimate how long before the infusion ends given a certain volume remaining in the syringe. </i>
				<table class="table-control">
					<tr class="fr"><td style="width:70%">Volume to be infused</td>
						<td>
							<input type="number" inputmode="decimal" id="inputVolume"  min="0" max="200" step="0.1" placeholder=" " onkeyup="displayTimeEstimation();">
						</td>
					</tr>
					<tr>
						<td>Ends in</td>
						<td><span id="timeEstimation_output">___</td>
					</tr>
				</table>
				<a class="button" id="btn_timeEstimation" onclick="displayTimeEstimation();">Apply</a>
			</div>
		</div>
		<div class="card" id="card_VolumeEstimation">
			<div class="cardtitle collapsiblecard">VOLUME ESTIMATION</div>
			<div class="cardcontents">
				<i style="color:grey; font-size:90%; padding-top:10px; padding-bottom:10px; display:block;">You can estimate how much drug volume is required for a certain duration of infusion.</i>
				<table class="table-control">
					<tr class="fr"><td style="width:70%">Duration remaining (mins)</td>
						<td>
							<input type="number" inputmode="decimal" id="inputTime"  min="0" max="200" step="0.1" placeholder=" " onkeyup="displayVolumeEstimation();">
						</td>
					</tr>
					<tr>
						<td>Volume required (mls)</td>
						<td><span id="volumeEstimation_output">___</td>
					</tr>
				</table>
				<a class="button" id="btn_volumeEstimation" onclick="displayVolumeEstimation();">Apply</a>
			</div>
		</div>
		<div class="card" id="card_wakeup">
			<div class="cardtitle collapsiblecard">WAKE-UP TIME</div>
			<div class="cardcontents">
				<i style="color:grey; font-size:90%; padding-top:10px; padding-bottom:10px; display:block;">To predict the wake-up time, or decrement time (time to reach a designated 'wake-up' concentration at the effect site) if the infusion is stopped at the current point. Default is 1mcg/ml.</i>
				<table class="table-control">
					<tr class="fr"><td style="width:70%">Wake-up concentration (mcg/ml)</td>
						<td>
							<select id="wakeupconc" onchange="sendtowakeup(this.value*1)">
								<option value="0.7">0.7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>
								<option value="0.8">0.8</option>
								<option value="0.9">0.9</option>
								<option value="1" selected="selected">1</option>
								<option value="1.1">1.1</option>
								<option value="1.2">1.2</option>
								<option value="1.3">1.3</option>
								<option value="1.4">1.4</option>
								<option value="1.5">1.5</option>
							</select>
						</td>
					</tr>
					<tr>
						<td>Wake-up time</td>
						<td><span id="wakeuptime">___</td>
					</tr>
				</table>
				<a class="button" id="btn_wakeup" onclick="sendtowakeup(document.getElementById('wakeupconc').value);">Apply</a>
			</div>
		</div>
		<div class="card" id="card_options">
			<div class="cardtitle">OPTIONS</div>
			<div class="cardcontents">
						<div id="ptolcardoptions">
      <label class="container labelptolcontainer" style="">Display detailed tab info
          <input type="checkbox" onChange="toggleshowtabinfo();" id="isTabInfo"><span class="checkmark"></span>
      </label>
      <!--<label class="container labelptolcontainer" style="">Display effective dose margins <span style='font-size: 80%'>(PTOL50-90)</span>
          <input type="checkbox" id="" onChange="toggleshowPTOLmargins();" checked><span class="checkmark"></span>
      </label>
    -->
    </div>
				<i style="color:grey; font-size:90%; padding-top:10px; padding-bottom:10px; display:block;">Some options are experimental features and available on Android devices only: these include Vibrate, Sound, Wakelock, and Notifications.</i>
				<table class="table-control">
					<!--options array-->
					<!-- 
					0[0:mg/kg/h, 1:mcg/kg/min],
					1[0:1x, 1:5x, 2:25x, 3:50x],
					2[0:auto, 1:lazy, 2:accurate],
					3[0:wakelockoff, 1:wakelockon],
					4[0:vibrateoff, 1:vibrateon],
					5[0:soundoff, 1:soundon],
					6[0:notifoff, 1:notifon]

					default is:
					[1,0],
					[1,0,0,0],
					[1,0,0],
					[1,0],
					[1,0],
					[1,0],
					[1,0]
					-->
					<!--end options array-->
					<tr class="fr" id="option_unit_row"><td>Unit for propofol <i class="far fa-question-circle tooltip background"><span class="tooltiptext" style="width:160px">Secondary unit for propofol infusion rate apart from ml/h. Refresh your CPT/CET target after change.</span></i></td>
						<td>
							<select id="select_unit">
								<option value="mgh">mg/kg/h</option>
								<option value="mcgmin">mcg/kg/m</option>
							</select>
						</td>
					<tr class="" id="option_defaultrateunit"><td>Default rate unit <i class="far fa-question-circle tooltip background"><span class="tooltiptext" style="width:160px">Unit for entering manual mode infusion rate, e.g. "ml/h" vs "mg/kg/h" (or appropriate units)</span></i></td>
						<td>
							<select id="select_defaultrateunit">
								<option value="mlh">ml/h</option>
								<option value="unitkgtime">mg/kg/h</option>
							</select>
						</td>
					</tr>
					<tr class="" id="option_defaultbolusunit"><td>Default bolus unit <i class="far fa-question-circle tooltip background"><span class="tooltiptext" style="width:160px">Unit for entering manual mode bolus, e.g. "mg" vs "mg/kg" vs "ml" (or appropriate units)</span></i></td>
						<td>
							<select id="select_defaultbolusunit">
								<option value="mg">mg</option>
								<option value="mgkg">mg/kg</option>
								<option value="ml">ml</option>
							</select>
						</td>
					</tr>
					<tr id="option_simspeed_row"><td>Simspeed</td>
						<td>
							<select id="select_simspeed">
								<option value="1">1x (Normal)</option>
								<option value="5">5x (Fast)</option>
								<option value="25">25x (Very fast)</option>
								<option value="50">50x (Super fast)</option>
							</select>
						</td>
					</tr>

					<tr id="option_threshold_row"><td>Threshold <i class="far fa-question-circle tooltip background"><span class="tooltiptext">Adjusts the threshold of CPT/CET infusion schemes. Lazy: less frequent rate changes. Accurate: more frequent rate changes.</span></i></td>
						<td>
							<select id="select_threshold">
								<option value="0">Auto</option>
								<option value="1">Lazy</option>
								<option value="2">Accurate</option> <!--0.13, 0.565-->
							</select>
						</td>
					</tr>
					<tr><td>Wakelock <i class="far fa-question-circle tooltip background"><span class="tooltiptext">Keeps screen on. Experimental. Android & some desktop devices only.</span></i></td>
						<td>
							<select id="select_wakelock">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>
					<tr><td>Vibrate</td>
						<td>
							<select id="select_vibrate">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>
					<tr><td>Sound</td>
						<td>
							<select id="select_sound">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>

					<tr><td>Notifications</td>
						<td>
							<select id="select_notification">
								<option value="off">Off</option>
								<option value="on">On</option>
							</select>
						</td>
					</tr>
					<!--
					<tr><td>Intermittent bolus <i style="font-size:70%">(Unstable)</i></td>
						<td>
							<select id="select_PPinterval">
								<option value="120">Q2min</option>
								<option value="180" selected>Q3min</option>
								<option value="300">Q5min</option>
							</select>
						</td>
					</tr>
				-->
					

					
				</table>
				<a class="button" id="btn_apply" onclick="applyoptions();">Apply</a>
				<a class="button right muted" id="btn_defaultoptions" onclick="loadoptions('default');loadoptions();applyoptions();">Reset settings</a>
				<!--
				<a class="button" id="btn_test_alert" onclick="testalert();">Test alert</a>
				<a class="button" id="btn_test_alertoff" onclick="testalertoff();">Alert Off</a>
				-->
			</div>
		</div>
		</div><!--end cards container layout-->
		<div class="bottomcard">
			<h1>SimTIVA is a computer simulation program to simulate delivery of total intravenous anaesthesia (TIVA) using a target-controlled infusion (TCI) pump. This progressive web app (PWA) is designed for use on smartphones, tablets and computers.</h1>
		</div>

		</div><!--controlpanel-->
		<div class="footer">
			<b>SIMTiva</b>&nbsp;|&nbsp;Terence Luk 2023
			<ul>
				<li><a href="#" onclick="setmodal('modalAbout');">About</a></li>
				<li><a href="https://simtiva.blogspot.com/" target="_blank">Blog</a></li>
				<li><a href="https://simtiva.blogspot.com/p/readme.html" target="_blank">Readme</a></li>
				<li><a href="https://simtiva.blogspot.com/p/feedback.html" target="_blank">Contact</a></li>
			</ul>
		</div>
		<!--
		<div class="ticker" id="ticker">
				<div id="progressoutside">
					<div id="progressbar">
						<div id="progressinside"></div>
					</div>
				</div>
				<div class="tickerleft" id="tickerleft">
					<div class="A1">
							<div class="A2">Next bolus:</div>
							<div class="A3"><span id="PP_bolus_display"></span>mg</div>
					</div>
					<div class="B1">
						<div class="B2">in</div>
						<div class="B3"><span id="PP_time_display">_</span></div>
					</div>
				</div>
				<div class="tickerright">
					<div class="A1">
							<div class="A2">Last bolus: </div>
						<div class="A3"><span id="PP_lastbolus_display"></span>mg</div>
					</div>
					<div class="B1">
						<div class="B2">at</div>
						<div class="B3"><span id="PP_lasttime_display">_</span></div>
					</div>		
				</div>
		</div>
		-->
	
	</div><!--bodywrapper-->
	
	<script src="main.js"></script>
	<script src="lz-string.js"></script>

	<script>init();</script>
	<script>


// Function that attempts to request a screen wake lock.
let wakeLock = null; //sentinel
const requestWakeLock = async () => {
  try {
    wakeLock = await navigator.wakeLock.request();
    wakeLock.addEventListener('release', () => {
      console.log('Screen Wake Lock released:', wakeLock.released);
    });
    console.log('Screen Wake Lock released:', wakeLock.released);
  } catch (err) {
    console.error(`${err.name}, ${err.message}`);
  }
};
//check for support
if (!('wakeLock' in navigator)) {
	document.getElementById("select_wakelock").disabled = true;
}


document.addEventListener('visibilitychange', async () => {
  const val = document.getElementById("select_wakelock").value;
  if (wakeLock !== null && document.visibilityState === 'visible' && val == "on") {
    requestWakeLock();
  }
});


// Function for custom install prompt

let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent the mini-infobar from appearing on mobile
  e.preventDefault();
  // Stash the event so it can be triggered later.
  deferredPrompt = e;
  // Update UI notify the user they can install the PWA
  //showInstallPromotion();
  // Optionally, send analytics event that PWA install promo was shown.
  console.log(`'beforeinstallprompt' event was fired.`);
});

window.addEventListener('appinstalled', () => {
  // Hide the app-provided install promotion
  hideInstallPromotion();
  // Clear the deferredPrompt so it can be garbage collected
  deferredPrompt = null;
  // Optionally, send analytics event to indicate successful install
  console.log('PWA was installed');
});

var t = null;

function showInstallPromotion() {
	if (deferredPrompt != undefined) {
	installbutton = document.getElementById("installbutton");
	installbutton.classList.add("show");
	clearTimeout(t);
	t = setTimeout(function() {
			installbutton.classList.add("hidebutton");
			installbutton.classList.remove("show");
		},30*1000);
	}
}

document.getElementById("installtext").addEventListener('click', async () => {
	hideInstallPromotion();
	deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  // Optionally, send analytics event with outcome of user choice
  console.log(`User response to the install prompt: ${outcome}`);
  // We've used the prompt, and can't use it again, throw it away
  deferredPrompt = null;
});

document.getElementById("installclose").addEventListener('click', function() {
	hideInstallPromotion();
	console.log('user click close install btn');
  deferredPrompt = null;
});

function hideInstallPromotion() {
	document.getElementById("installbutton").classList.remove("show");
}


// function for scroll detection
var prevScrollpos = 0;
var scrolldistancetimeout = null;
let installbutton = document.getElementById("installbutton");
let sharebutton = document.getElementById("sharebutton");
let darkmodebutton = document.getElementById("darkmodebutton");
let footer = document.querySelector(".footer");
var viewportheight = window.innerHeight;

document.addEventListener('scroll', (event) => {
  var currentScrollPos = window.pageYOffset;
  var distance = currentScrollPos - prevScrollpos;
  var y = footer.offsetTop - viewportheight;

  clearTimeout(scrolldistancetimeout);
  scrolldistancetimeout = setTimeout(function() {

  	if (currentScrollPos < y) {
	  	if (distance > 10) {
	  		installbutton.classList.add("scrollhide");
	  		sharebutton.classList.add("scrollhide");
	  		darkmodebutton.classList.add("scrollhide");
	  	} else {
	  		installbutton.classList.remove("scrollhide");
	  		sharebutton.classList.remove("scrollhide");
	  		darkmodebutton.classList.remove("scrollhide");
	  	}
	  } else {
	  		installbutton.classList.remove("scrollhide");
	  		sharebutton.classList.remove("scrollhide");
	  		darkmodebutton.classList.remove("scrollhide");
	  }
  	prevScrollpos = currentScrollPos;

  },100)

  /*
  var distance = currentScrollPos - prevScrollpos;
  var y = document.getElementById("bottom-bar").offsetTop - window.innerHeight;
  if (viewportheight > 520) {

    var z = Math.round(currentScrollPos/2.3);//larger denominator = move faster
    var zz = (currentScrollPos < 150) ? 1 : (250-currentScrollPos)/100;
    
    

    if (scrolltimeout) {
      window.cancelAnimationFrame(scrolltimeout);
    }

    scrolltimeout = window.requestAnimationFrame( function() {
        if (currentScrollPos < 300) {
          document.getElementById("parallax").style.transform = "translateY(" + z +"px)";
          document.getElementById("parallax").style.opacity = zz;
        }
      });
  }

  clearTimeout(scrolldistancetimeout);
  scrolldistancetimeout = setTimeout(function() {
      
        if (distance > 8) {
          document.getElementById("navbar").classList.add("hidden");
          document.getElementById("logo").classList.add("small");
        } else {
          if (distance < -8) {
            document.getElementById("navbar").classList.remove("hidden");
            document.getElementById("logo").classList.remove("small");
          }
        }
        if (currentScrollPos > y) {
          document.getElementById("footer1").classList.add("hidden");
        } else {
          document.getElementById("footer1").classList.remove("hidden");
        }
        prevScrollpos = currentScrollPos;
      

    }, 50);

*/
}, false)

	</script>
	<!-- chart.js from https://cdnjs.com/libraries/Chart.js-->
	<script src="chart.min.js"></script>
	<script src="chartjs-plugin-crosshair.min.js"></script>
	<script>

	</script>
	<script>setTimeout(function() {loadoptions();parseobject()},2000);</script>
</body>
</html>